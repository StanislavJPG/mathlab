{% extends 'base/forum_base.html' %}
{% load i18n static   widget_tweaks %}

{% block page_head %}
  <script src="{% static 'tinymce/tinymce.min.js' %}"></script>
  <script src="{% static 'django_tinymce/init_tinymce.js' %}"></script>
  <link type="text/css" href="{% static 'forum_question.css' %}" rel="stylesheet">
  <title>{{ post.categories.first.get_name_display }} - {{ post.title }}</title>
{% endblock page_head %}

{% block body %}
  <div class="base-content">
  <div>
    <h1 class="display-5 title">
      {{ post.title }}
    </h1>
    <div class="types">
      <span class="span-base"><b>Автор:</b>
          <a style="text-decoration: none;"
             href="{% url 'forum:profile' user_id=post.user.id username=post.user.username %}">{{ post.user.username }}</a> |
          <b>{{ post.user.rank }}</b></span>
      <span class="span-base"><b>Створено</b> {{ post.created_at|timesince }} тому</span>
      <span class="span-base"><b>Модифіковано</b> {{ post.modified_at|timesince }} тому</span>
      <span class="span-base"><b>Переглянуто</b> {{ post.post_views }} разів</span>
    </div>
    <div class="d_line"></div>
    <div class="interact">
      {% block post_likes_and_dislikes %}
        <div hx-get="{% url 'forum:hx-post-rate' post.uuid %}"
             hx-trigger="postLikesAndDislikesChanged from:body"
             hx-target="this"
        >
          <a type="button"
             class="{% if not post.is_already_liked %}text-secondary{% endif %} text-decoration-none d-flex flex-column align-items-center"
             hx-swap="none"
             hx-post="{% url 'forum:hx-post-rate' post.uuid %}?like=true">
              <i style="font-size: 35px" class="ti ti-thumb-up"></i>
            {{ post.custom_likes_counter }}
          </a>
          <a type="button"
             class="{% if not post.is_already_disliked %}text-secondary{% endif %} text-decoration-none d-flex flex-column align-items-center"
             hx-swap="none"
             hx-post="{% url 'forum:hx-post-rate' post.uuid %}">
            <i style="font-size: 35px" class="ti ti-thumb-down"></i>
            {{ post.custom_dislikes_counter }}
          </a>
        </div>
      {% endblock post_likes_and_dislikes %}
    </div>
    <div class="question-content">
      <p class="text-justify">
        {{ post.content|safe }}
      </p>
      <div class="topics">
        {% for category in post.categories.all %}
          <a href="{% url 'forum:post-list' %}?sort=popular&page=1&tags={{ сategory }}"
             class="a-topic">{{ category.get_name_display }}</a>
        {% endfor %}
      </div>
    </div>

    <div class="comment">
      <div class="mt-3">
        <div hx-get="{% url 'forum:comments-count' post.uuid %}"
             hx-trigger="commentBlockChanged from:body"
             hx-target="this">
          {% with comment_quantity=post.comments_quantity %}
            {% block comment_quantity %}
              <span class="mt-4">
                  {% translate 'Answers' %}: {{ comment_quantity }}
              </span>
            {% endblock %}
          {% endwith %}
        </div>
        <div class="sort">
          <div class="dropdown" style="margin-top: 5px; margin-bottom: 50px; ">
            <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
                    aria-expanded="false" style="font-size: 10px;">
              {% translate 'Sort by' %}:
            </button>
            <ul class="dropdown-menu">
              <li>
                <a style="font-size: 15px;"
                   class="dropdown-item"
                   href="javascript:(0);"
                   hx-get="{% url 'forum:comments-block' post.uuid %}?order_by=best"
                   hx-select="#comment-list-js"
                   hx-target="#comment-list-js"
                   hx-trigger="click"
                >
                  {% translate 'Best' %}
                </a>
              </li>
              <li>
                <a style="font-size: 15px;"
                   class="dropdown-item"
                   href="javascript:(0);"
                   hx-get="{% url 'forum:comments-block' post.uuid %}?order_by=newest"
                   hx-select="#comment-list-js"
                   hx-target="#comment-list-js"
                   hx-trigger="click"
                >
                  {% translate 'Newest' %}
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div hx-get="{% url 'forum:comments-block' post.uuid %}"
           hx-indicator="#comment-block-wait-spinner"
           hx-target="this"
           hx-trigger="load">
{#        Content will be placed here  #}
        <div id="comment-block-wait-spinner" class="spinner-grow text-primary mt-2" role="status"></div>
      </div>

      <h1 style="font-size: 20px; margin-top: 150px;">Ваша відповідь</h1>
      {% if user.is_authenticated %}
        <div id="comment-block-js" hx-get="{% url 'forum:comment-create' post.uuid %}" hx-target="this"
             hx-trigger="load delay:0.5s" hx-indicator="#comment-wait-spinner">
        {#            Content will be placed here   #}
          <div id="comment-wait-spinner" class="spinner-grow text-primary mt-2" role="status"></div>
        <div>
      {% else %}
        <h1 style="font-size: 20px; margin-top: 50px;"><a style="text-decoration: none;" href="{% url 'login_view' %}">Авторизуйтесь</a>,
          щоб залишити відповідь.</h1>
      {% endif %}
      </div>
      </div>
    </div>
  </div>
  </div>
{% endblock %}
